---

- name: Install apt packages
  apt:
    name:
    - git
    - python3-pip
    - curl
    - nmap
    update_cache: yes
  become: true

- name: Download Go 1.25.1
  get_url:
    url: https://go.dev/dl/go1.25.1.linux-amd64.tar.gz    
    dest: /tmp/go.tar.gz
  become: true

- name: Extract Go
  unarchive:
    src: /tmp/go.tar.gz
    dest: /usr/local
    remote_src: yes
  become: true

- name: Add Go to debian profile
  lineinfile:
    path: /home/debian/.profile
    line: 'export PATH=/usr/local/go/bin:$PATH'
  become: true

- name: Install Bettercap
  command: bash -c "source /home/debian/.profile && go install github.com/bettercap/bettercap@latest"
  become: true

- name: Copy bettercap proxies
  copy:
    src: files/
    dest: /home/debian/proxies/
    owner: debian
    group: debian
    mode: '0644'

- name: Copy bettercap proxy script
  ansible.builtin.template:
    src: bettercap_proxy.cap
    dest: /home/debian/bettercap_proxy.cap
    owner: debian
    group: debian
    mode: '0644'
